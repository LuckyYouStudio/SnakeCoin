# 🔧 MetaMask连接故障排除指南

## 🚨 常见问题及解决方案

### 1. MetaMask未安装

**症状**: 页面显示"请安装MetaMask钱包！"

**解决方案**:
1. 访问 [MetaMask官网](https://metamask.io/)
2. 下载并安装浏览器扩展
3. 创建或导入钱包
4. 刷新页面重试

### 2. MetaMask未解锁

**症状**: 连接时出现"用户拒绝了连接请求"

**解决方案**:
1. 点击浏览器工具栏中的MetaMask图标
2. 输入密码解锁钱包
3. 重新尝试连接

### 3. 网络不匹配

**症状**: 连接成功但无法获取合约信息

**解决方案**:
1. 确保MetaMask连接到正确的网络
2. 对于本地测试，需要连接到Hardhat网络
3. 使用调试页面的"切换到本地网络"按钮

### 4. 合约地址错误

**症状**: 显示"合约地址格式错误"

**解决方案**:
1. 确保合约已正确部署
2. 检查合约地址是否正确
3. 重新部署合约并更新地址

### 5. 余额不足

**症状**: 抽奖时显示"余额不足"

**解决方案**:
1. 确保账户有足够的ETH支付抽奖费用
2. 对于本地测试，使用Hardhat提供的测试账户
3. 检查gas费用设置

## 🔍 诊断步骤

### 步骤1: 检查MetaMask状态
1. 打开浏览器开发者工具 (F12)
2. 在控制台中输入: `typeof window.ethereum`
3. 如果返回 `"undefined"`，说明MetaMask未安装

### 步骤2: 检查网络连接
1. 在MetaMask中查看当前网络
2. 确保连接到正确的网络 (本地测试为Hardhat)
3. 检查网络ID是否为 `0x7a69`

### 步骤3: 检查账户状态
1. 确保MetaMask已解锁
2. 确保有可用的账户
3. 检查账户余额

### 步骤4: 检查合约部署
1. 确保Hardhat节点正在运行
2. 确保合约已成功部署
3. 验证合约地址是否正确

## 🛠️ 使用调试页面

我们创建了一个专门的调试页面 `demo/lottery-debug.html`，它会：

1. **自动诊断** - 检查所有必要的组件
2. **显示详细错误** - 提供具体的错误信息
3. **提供修复建议** - 根据问题给出解决方案
4. **网络切换** - 自动切换到正确的网络

### 使用步骤:
1. 打开 `demo/lottery-debug.html`
2. 点击"运行诊断"按钮
3. 查看诊断结果
4. 按照建议修复问题
5. 重新尝试连接

## 📋 检查清单

在连接MetaMask之前，请确认：

- [ ] MetaMask已安装并解锁
- [ ] 连接到正确的网络 (本地测试: Hardhat)
- [ ] 有可用的账户和足够的余额
- [ ] 合约已正确部署
- [ ] 浏览器支持Web3 (Chrome, Firefox, Edge)
- [ ] 没有浏览器扩展冲突

## 🔄 重置步骤

如果问题持续存在，尝试以下重置步骤：

1. **刷新页面** - 清除临时状态
2. **重启MetaMask** - 关闭并重新打开扩展
3. **重启浏览器** - 清除所有缓存
4. **重新部署合约** - 确保合约状态正确
5. **使用新账户** - 尝试使用不同的MetaMask账户

## 📞 获取帮助

如果问题仍然存在：

1. **查看浏览器控制台** - 检查错误信息
2. **查看MetaMask日志** - 在MetaMask中查看交易历史
3. **检查网络状态** - 确保Hardhat节点正常运行
4. **查看合约状态** - 使用Hardhat控制台检查合约

## 🎯 快速测试

要快速测试连接是否正常：

1. 打开 `demo/lottery-debug.html`
2. 运行诊断
3. 如果所有检查都通过，说明连接正常
4. 如果有问题，按照诊断结果修复

## 💡 预防措施

为了避免连接问题：

1. **定期更新MetaMask** - 保持最新版本
2. **备份钱包** - 保存助记词和私钥
3. **使用测试网络** - 在测试网络上先验证功能
4. **监控gas费用** - 确保有足够的ETH支付交易费用
5. **检查网络状态** - 确保目标网络正常运行

---

**记住**: 大多数连接问题都可以通过正确的诊断和修复步骤解决。如果遇到困难，请使用调试页面获取详细的错误信息和解决方案。


